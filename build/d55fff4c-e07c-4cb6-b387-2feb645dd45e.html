<!DOCTYPE html>
<html lang="CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>虚拟DOM与diff算法</title>
    <link rel="stylesheet" href="fc4af8f8-9bf8-4535-b662-7caea4bacc08.css" />
  </head>
  <body>
    <div class="container">
      <div class="nav">
        
        <div>
          <p class="menu">Git</p>
          <ul>
            <li>
               
                
                  <a
                    id="3d8f3d4d-44e4-47fc-bcbe-35242ea611dc"
                    class="menu-item"
                    href="3d8f3d4d-44e4-47fc-bcbe-35242ea611dc.html "
                  >
                    Git 学习
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">JavaScript</p>
          <ul>
            <li>
               
                
                  <a
                    id="aca6b30c-9715-4e56-b7e7-4fc308f222cb"
                    class="menu-item"
                    href="aca6b30c-9715-4e56-b7e7-4fc308f222cb.html "
                  >
                    JavaScript异步处理
                  </a>
                 
               
                
                  <a
                    id="21e850ca-1a15-4278-8e2f-914afad5d79e"
                    class="menu-item"
                    href="21e850ca-1a15-4278-8e2f-914afad5d79e.html "
                  >
                    JavaScript数组
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">linux</p>
          <ul>
            <li>
               
                
                  <a
                    id="8e68477c-b2af-4b46-8a69-8101da934db0"
                    class="menu-item"
                    href="8e68477c-b2af-4b46-8a69-8101da934db0.html "
                  >
                    ArchLinux安装美化之系统安装
                  </a>
                 
               
                
                  <a
                    id="b9141555-5e09-4477-ab97-0c29b03d4339"
                    class="menu-item"
                    href="b9141555-5e09-4477-ab97-0c29b03d4339.html "
                  >
                    Linux 压缩和解压缩命令
                  </a>
                 
               
                
                  <a
                    id="b50b870c-1376-4816-848c-4dfe0c64570b"
                    class="menu-item"
                    href="b50b870c-1376-4816-848c-4dfe0c64570b.html "
                  >
                    Linux 网络配置
                  </a>
                 
               
                
                  <a
                    id="83a6fd5b-4d70-439e-8dd5-3ffda24ac80d"
                    class="menu-item"
                    href="83a6fd5b-4d70-439e-8dd5-3ffda24ac80d.html "
                  >
                    nvm 安装与配置
                  </a>
                 
               
                
                  <a
                    id="d1038037-38af-4db2-9364-9fa7c30731ea"
                    class="menu-item"
                    href="d1038037-38af-4db2-9364-9fa7c30731ea.html "
                  >
                    oh-my-zsh 安装与配置
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">MongDB</p>
          <ul>
            <li>
               
                
                  <a
                    id="88cb4ac1-3fc2-4ec1-81eb-f741eb15acbf"
                    class="menu-item"
                    href="88cb4ac1-3fc2-4ec1-81eb-f741eb15acbf.html "
                  >
                    MongoDB基本使用
                  </a>
                 
               
                
                  <a
                    id="f14dd8d5-448f-4c71-b2ca-59a7944a0f14"
                    class="menu-item"
                    href="f14dd8d5-448f-4c71-b2ca-59a7944a0f14.html "
                  >
                    MongoDB权限配置
                  </a>
                 
               
                
                  <a
                    id="27460c87-73ea-4d6b-89ee-e64ba53675d7"
                    class="menu-item"
                    href="27460c87-73ea-4d6b-89ee-e64ba53675d7.html "
                  >
                    MongoDB进阶
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">Nginx</p>
          <ul>
            <li>
               
                
                  <a
                    id="5363633d-73cd-4c16-afc6-4f8326375813"
                    class="menu-item"
                    href="5363633d-73cd-4c16-afc6-4f8326375813.html "
                  >
                    Nginx安装
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">npm</p>
          <ul>
            <li>
               
                
                  <a
                    id="8e85723d-0a63-430f-a989-54de5f7f24a7"
                    class="menu-item"
                    href="8e85723d-0a63-430f-a989-54de5f7f24a7.html "
                  >
                    npm-workspace
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">PowerShell</p>
          <ul>
            <li>
               
                
                  <a
                    id="90d523a1-896b-497a-90fa-457fa14d7989"
                    class="menu-item"
                    href="90d523a1-896b-497a-90fa-457fa14d7989.html "
                  >
                    PoserShell 学习
                  </a>
                 
               
                
                  <a
                    id="ca40e0c9-3d6a-42ba-8dad-aafef185336b"
                    class="menu-item"
                    href="ca40e0c9-3d6a-42ba-8dad-aafef185336b.html "
                  >
                    powershell 命令
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">rust</p>
          <ul>
            <li>
               
                
                  <a
                    id="747ebcc1-c355-4c48-97a4-5aad83d26cab"
                    class="menu-item"
                    href="747ebcc1-c355-4c48-97a4-5aad83d26cab.html "
                  >
                    Rust 基础
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">TypeScript</p>
          <ul>
            <li>
               
                
                  <a
                    id="070a159e-4607-4a7b-92ab-7917fd91a64f"
                    class="menu-item"
                    href="070a159e-4607-4a7b-92ab-7917fd91a64f.html "
                  >
                    TypeScript 基本项目搭建
                  </a>
                 
               
                
                  <a
                    id="00c438f4-0561-48d1-9d5b-909f189b66f9"
                    class="menu-item"
                    href="00c438f4-0561-48d1-9d5b-909f189b66f9.html "
                  >
                    TypeScript类型与配置笔记
                  </a>
                 
               
                
                  <a
                    id="c1588032-29f7-49b3-9036-b446c067968d"
                    class="menu-item"
                    href="c1588032-29f7-49b3-9036-b446c067968d.html "
                  >
                    TypeScript面向对象笔记
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">vscode</p>
          <ul>
            <li>
               
                
                  <a
                    id="4512ce56-e012-41fe-9261-6fd36e146cc0"
                    class="menu-item"
                    href="4512ce56-e012-41fe-9261-6fd36e146cc0.html "
                  >
                    vscode配置
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">vue3</p>
          <ul>
            <li>
               
                
                  <a
                    id="51c2f2f2-e073-4e8f-8bc4-b196318a3ab0"
                    class="menu-item"
                    href="51c2f2f2-e073-4e8f-8bc4-b196318a3ab0.html "
                  >
                    Composition API(其它部分)
                  </a>
                 
               
                
                  <a
                    id="c92539e2-f745-42ac-ada0-8852c96c0099"
                    class="menu-item"
                    href="c92539e2-f745-42ac-ada0-8852c96c0099.html "
                  >
                    Composition API(常用部分)
                  </a>
                 
               
                
                  <a
                    id="314a1c59-105c-416d-ad6b-8f3e8454aaff"
                    class="menu-item"
                    href="314a1c59-105c-416d-ad6b-8f3e8454aaff.html "
                  >
                    Vue3 新组件
                  </a>
                 
               
                
                  <a
                    id="f4b0d58a-6955-4e49-95e7-b358737ffbec"
                    class="menu-item"
                    href="f4b0d58a-6955-4e49-95e7-b358737ffbec.html "
                  >
                    vue3快速上手
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">webpack</p>
          <ul>
            <li>
               
                
                  <a
                    id="6371bd9c-ba00-4086-8946-081fc7abed49"
                    class="menu-item"
                    href="6371bd9c-ba00-4086-8946-081fc7abed49.html "
                  >
                    vue+ts+eslint前端项目搭建
                  </a>
                 
               
                
                  <a
                    id="88c1a73d-b2e0-45f0-94f4-69c2262ba5e6"
                    class="menu-item"
                    href="88c1a73d-b2e0-45f0-94f4-69c2262ba5e6.html "
                  >
                    webpack + vue 企业级项目搭建
                  </a>
                 
               
                
                  <a
                    id="5d6e6c06-e544-4538-b61b-87442e486ae3"
                    class="menu-item"
                    href="5d6e6c06-e544-4538-b61b-87442e486ae3.html "
                  >
                    webpack配置
                  </a>
                 
               
                
                  <a
                    id="b8967e0e-fea9-4962-ab88-d7ca456e8777"
                    class="menu-item"
                    href="b8967e0e-fea9-4962-ab88-d7ca456e8777.html "
                  >
                    前端常用
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">Windows</p>
          <ul>
            <li>
               
                
                  <a
                    id="2d1913b7-ccd0-401f-a2fe-19705ab762e9"
                    class="menu-item"
                    href="2d1913b7-ccd0-401f-a2fe-19705ab762e9.html "
                  >
                    Windows Terminal设置代理
                  </a>
                 
               
                
                  <a
                    id="f1b8f050-83b6-42b4-ac41-bb71b5e34321"
                    class="menu-item"
                    href="f1b8f050-83b6-42b4-ac41-bb71b5e34321.html "
                  >
                    Windows安装优化
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">其它</p>
          <ul>
            <li>
               
                
                  <a
                    id="427a85cb-f611-4a87-b7cc-9c41f02a8d70"
                    class="menu-item"
                    href="427a85cb-f611-4a87-b7cc-9c41f02a8d70.html "
                  >
                    mustache模板引擎
                  </a>
                 
               
                
                  <a
                    id="bf1fba5a-1ad1-4a00-8890-f5f60b4fa537"
                    class="menu-item"
                    href="bf1fba5a-1ad1-4a00-8890-f5f60b4fa537.html "
                  >
                    双向数据绑定
                  </a>
                 
               
                
                  <a
                    id="880f6972-0e24-4031-a62d-718e16abc9ab"
                    class="menu-item"
                    href="880f6972-0e24-4031-a62d-718e16abc9ab.html "
                  >
                    抽象语法树
                  </a>
                 
               
                
                  <a
                    id="d55fff4c-e07c-4cb6-b387-2feb645dd45e"
                    class="menu-active"
                    href="d55fff4c-e07c-4cb6-b387-2feb645dd45e.html "
                  >
                    虚拟DOM与diff算法
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">打包构建工具</p>
          <ul>
            <li>
               
                
                  <a
                    id="16fbbd30-d920-4abf-81e2-4b5510e8b28f"
                    class="menu-item"
                    href="16fbbd30-d920-4abf-81e2-4b5510e8b28f.html "
                  >
                    Grunt
                  </a>
                 
               
                
                  <a
                    id="aa643820-2b2e-4bc3-b095-492a2bbccbef"
                    class="menu-item"
                    href="aa643820-2b2e-4bc3-b095-492a2bbccbef.html "
                  >
                    Gulp
                  </a>
                 
               
                
                  <a
                    id="d4882ee5-ff38-4978-93a1-e7bca404d47b"
                    class="menu-item"
                    href="d4882ee5-ff38-4978-93a1-e7bca404d47b.html "
                  >
                    Rollup
                  </a>
                 
              
            </li>
          </ul>
        </div>
        
      </div>
      <div class="content">
        
        <div><h1 id="虚拟-dom-与-diff-算法">虚拟 DOM 与 diff 算法</h1>
<p><strong>虚拟 DOM：</strong></p>
<ul>
<li>用 JavaScript 对象描述 DOM 的层次结构。DOM 中的一切属性都在虚拟 DOM 中有对应的属性。</li>
</ul>
<h2 id="snabbdom-库安装">snabbdom 库安装</h2>
<p>Snabbdom 由一个非常简单，高性能和可扩展的内核组成，仅约 200 SLOC。 它提供了具有丰富功能的模块化体系结构，可通过自定义模块进行扩展。 为了使核心保持简单，所有非必要功能都委托给模块</p>
<pre><code class="hljs language-shell">npm install -D snabbdom
</code></pre>
<h2 id="snabbdom-测试环境搭建">snabbdom 测试环境搭建</h2>
<h3 id="安装依赖">安装依赖</h3>
<pre><code class="hljs language-shell">npm install -D webpack webpack-cli webpack-dev-server html-webpack-plugin
</code></pre>
<h3 id="配置-webpackconfigjs-文件">配置 webpack.config.js 文件</h3>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> { resolve } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HTMLWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;html-webpack-plugin&quot;</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-attr">entry</span>: <span class="hljs-string">&quot;./src/js/index.js&quot;</span>,
    <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">path</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;dist&quot;</span>),
        <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;js/index.js&quot;</span>,
    },
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">HTMLWebpackPlugin</span>({
            <span class="hljs-attr">template</span>: <span class="hljs-string">&quot;./src/index.html&quot;</span>,
        }),
    ],
    <span class="hljs-attr">devServer</span>: {
        <span class="hljs-attr">contentBase</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&quot;dist&quot;</span>),
        <span class="hljs-attr">port</span>: <span class="hljs-number">8001</span>,
        <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>,
    },
};
</code></pre>
<h3 id="运行测试案例">运行测试案例</h3>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { init } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/init&quot;</span>;
<span class="hljs-keyword">import</span> { classModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/modules/class&quot;</span>;
<span class="hljs-keyword">import</span> { propsModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/modules/props&quot;</span>;
<span class="hljs-keyword">import</span> { styleModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/modules/style&quot;</span>;
<span class="hljs-keyword">import</span> { eventListenersModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/modules/eventlisteners&quot;</span>;
<span class="hljs-keyword">import</span> { h } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/h&quot;</span>; <span class="hljs-comment">// helper function for creating vnodes</span>

<span class="hljs-keyword">const</span> patch = <span class="hljs-title function_">init</span>([
    <span class="hljs-comment">// Init patch function with chosen modules</span>
    classModule, <span class="hljs-comment">// makes it easy to toggle classes</span>
    propsModule, <span class="hljs-comment">// for setting properties on DOM elements</span>
    styleModule, <span class="hljs-comment">// handles styling on elements with support for animations</span>
    eventListenersModule, <span class="hljs-comment">// attaches event listeners</span>
]);

<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;container&quot;</span>);

<span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;div#container.two.classes&quot;</span>, { <span class="hljs-attr">on</span>: { <span class="hljs-attr">click</span>: <span class="hljs-function">() =&gt;</span> {} } }, [
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;span&quot;</span>, { <span class="hljs-attr">style</span>: { <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">&quot;bold&quot;</span> } }, <span class="hljs-string">&quot;This is bold&quot;</span>),
    <span class="hljs-string">&quot; and this is just normal text&quot;</span>,
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;a&quot;</span>, { <span class="hljs-attr">props</span>: { <span class="hljs-attr">href</span>: <span class="hljs-string">&quot;/foo&quot;</span> } }, <span class="hljs-string">&quot;I&#x27;ll take you places!&quot;</span>),
]);
<span class="hljs-comment">// Patch into empty DOM element – this modifies the DOM as a side effect</span>
<span class="hljs-title function_">patch</span>(container, vnode);

<span class="hljs-keyword">const</span> newVnode = <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;div#container.two.classes&quot;</span>, { <span class="hljs-attr">on</span>: { <span class="hljs-attr">click</span>: <span class="hljs-function">() =&gt;</span> {} } }, [
    <span class="hljs-title function_">h</span>(
        <span class="hljs-string">&quot;span&quot;</span>,
        { <span class="hljs-attr">style</span>: { <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">&quot;normal&quot;</span>, <span class="hljs-attr">fontStyle</span>: <span class="hljs-string">&quot;italic&quot;</span> } },
        <span class="hljs-string">&quot;This is now italic type&quot;</span>
    ),
    <span class="hljs-string">&quot; and this is still just normal text&quot;</span>,
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;a&quot;</span>, { <span class="hljs-attr">props</span>: { <span class="hljs-attr">href</span>: <span class="hljs-string">&quot;/bar&quot;</span> } }, <span class="hljs-string">&quot;I&#x27;ll take you places!&quot;</span>),
]);
<span class="hljs-comment">// Second `patch` invocation</span>
<span class="hljs-title function_">patch</span>(vnode, newVnode); <span class="hljs-comment">// Snabbdom efficiently updates the old view to the new state</span>
</code></pre>
<h2 id="虚拟-dom-与-h-函数学习">虚拟 DOM 与 h 函数学习</h2>
<p> <strong>h 函数</strong></p>
<p>h 函数用来生成虚拟节点（vnode）。</p>
<p><strong>参数：</strong></p>
<ul>
<li>sel：标签名称</li>
<li>props：标签属性</li>
<li>children：子节点</li>
</ul>
<p><strong>返回值：</strong></p>
<ul>
<li>children：表示子元素。</li>
<li>data：元素属性。</li>
<li>elm：表示是否上树。</li>
<li>key：元素唯一标识。</li>
<li>sel：表示选择器。</li>
<li>text：元素中的文字。</li>
</ul>
<h3 id="案例">案例</h3>
<pre><code class="hljs language-js"><span class="hljs-comment">// 创建patch函数</span>
<span class="hljs-keyword">const</span> patch = <span class="hljs-title function_">init</span>([
    classModule,
    propsModule,
    styleModule,
    eventListenersModule,
]);

<span class="hljs-comment">// 创建虚拟节点</span>
<span class="hljs-keyword">let</span> myVnode = <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;ul&quot;</span>, [
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;li&quot;</span>, {}, <span class="hljs-string">&quot;苹果&quot;</span>),
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;li&quot;</span>, { <span class="hljs-attr">class</span>: { <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> } }, <span class="hljs-string">&quot;香蕉&quot;</span>),
]);

<span class="hljs-comment">// 虚拟DOM上树</span>
<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;container&quot;</span>);
<span class="hljs-title function_">patch</span>(container, myVnode);
</code></pre>
<h3 id="手写低配版-h-函数">手写低配版 h 函数</h3>
<p><strong>vnode 函数：</strong></p>
<pre><code class="hljs language-js"><span class="hljs-comment">// vnode就是把传入的5个参数组合成对象返回</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">vnode</span>(<span class="hljs-params">sel, data, children, text, elm</span>) {
    <span class="hljs-keyword">return</span> {
        sel,
        data,
        children,
        text,
        elm,
    };
}
</code></pre>
<p><strong>h 函数：</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> vnode <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./vnode.js&quot;</span>;

<span class="hljs-comment">/**
 * 这个函数只实现3个参数功能，缺一不可
 * 调用形态必须为下面三种之一：
 *  形态① h(&#x27;div&#x27;, {}, &#x27;文字&#x27;)
 *  形态② h(&#x27;div&#x27;, {}, [])
 *  形态③ h(&#x27;div&#x27;, {}, h())
 */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">h</span>(<span class="hljs-params">sel, data, c</span>) {
    <span class="hljs-comment">// 检测参数个数</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> !== <span class="hljs-number">3</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;h函数必须传入三个参数&quot;</span>);

    <span class="hljs-comment">// 检测参数c的类型</span>

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> c === <span class="hljs-string">&quot;string&quot;</span> || <span class="hljs-keyword">typeof</span> c === <span class="hljs-string">&quot;number&quot;</span>) {
        <span class="hljs-comment">// 说明是形态①</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">vnode</span>(sel, data, <span class="hljs-literal">undefined</span>, c, <span class="hljs-literal">undefined</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(c)) {
        <span class="hljs-comment">// 说明是形态②</span>
        <span class="hljs-comment">// 收集children</span>
        <span class="hljs-keyword">let</span> children = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; c.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-comment">// 检测c[i]</span>
            <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">typeof</span> c[i] === <span class="hljs-string">&quot;object&quot;</span> &amp;&amp; c[i].<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">&quot;sel&quot;</span>)))
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;传入的数组参数中有项不是h函数&quot;</span>);
            children.<span class="hljs-title function_">push</span>(c[i]);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">vnode</span>(sel, data, children, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> c === <span class="hljs-string">&quot;object&quot;</span> &amp;&amp; c.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">&quot;sel&quot;</span>)) {
        <span class="hljs-comment">// 说明是形态③</span>
        <span class="hljs-comment">// 传入的c是唯一的children</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">vnode</span>(sel, data, [c], <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;传入的第三个参数类型不对&quot;</span>);
    }
}
</code></pre>
<p><strong>测试：</strong></p>
<pre><code class="hljs language-js"><span class="hljs-comment">// 引入自己的h函数</span>
<span class="hljs-keyword">import</span> h <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./mySnabbdom/h.js&quot;</span>;

<span class="hljs-keyword">import</span> { init } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/init&quot;</span>;
<span class="hljs-keyword">import</span> { classModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/modules/class&quot;</span>;
<span class="hljs-keyword">import</span> { propsModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/modules/props&quot;</span>;
<span class="hljs-keyword">import</span> { styleModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/modules/style&quot;</span>;
<span class="hljs-keyword">import</span> { eventListenersModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;snabbdom/modules/eventlisteners&quot;</span>;

<span class="hljs-comment">// 创建patch函数</span>
<span class="hljs-keyword">const</span> patch = <span class="hljs-title function_">init</span>([
    classModule,
    propsModule,
    styleModule,
    eventListenersModule,
]);

<span class="hljs-keyword">let</span> myVnode1 = <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;div&quot;</span>, {}, [
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;p&quot;</span>, {}, <span class="hljs-string">&quot;你好&quot;</span>),
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;p&quot;</span>, {}, <span class="hljs-string">&quot;你好&quot;</span>),
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;p&quot;</span>, {}, <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;span&quot;</span>, {}, <span class="hljs-string">&quot;hello&quot;</span>)),
]);

<span class="hljs-comment">// 虚拟DOM上树</span>
<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;container&quot;</span>);
<span class="hljs-title function_">patch</span>(container, myVnode1);
</code></pre>
<h2 id="diff-算法">diff 算法</h2>
<ul>
<li><p>diff 算法可以进行精细化比对，实现最小量更新。</p>
</li>
<li><p>diff 算法只发生在虚拟 DOM 上。</p>
</li>
<li><p>新虚拟 DOM 和老虚拟 DOM 进行 diff（精细化比较），算出应该如何最小量更新，最后反映到真正的 DOM</p>
</li>
<li><p>diff 只进行同层比较，不会进行跨层比较。即使是同一片虚拟节点，但是跨层了，diff 不进行比较，而是直接删除旧的，然后插入新的。</p>
</li>
<li><p>diff 只有是同一个虚拟节点（选择器相同，kye 相同视为同一个节点），才会进行精细化比较，否则直接删除旧的，然后插入新的。</p>
</li>
<li><p>diff 同一节点内会实现精细化比较，当然，key 很重要，key 是这个节点的唯一标识，告诉 diff 算法，在更新前后它们是同一个节点。</p>
</li>
</ul>
<p><strong>diff 算法流程图(简易版本)</strong></p>
<h3 id="diff-算法工作流程">diff 算法工作流程</h3>
<ul>
<li>1、patch 函数调用，接收两个值，旧虚拟 DOM（oldVnode）与新虚拟 DOM（vnode）。</li>
<li>2、判断 oldVnode 是否是虚拟节点。<ul>
<li>不是虚拟节点：通过 vnode 函数将 oldVnode 转换成虚拟节点。</li>
</ul>
</li>
<li>3、oldVnode 是虚拟节点，则判断 oldVnode 与 vnode 是否是同一个节点。<ul>
<li>不是同一个节点：插入新节点，删旧节点。</li>
</ul>
</li>
<li>4、是同一个节点，则判断 oldVnode 与 vnode 是不是内存种的同一个对象。<ul>
<li>是同一个对象：什么都不做。</li>
</ul>
</li>
<li>5、不是同一个对象，则判断 vnode 有没有 text。<ul>
<li>有 text：判断 oldVnode 的 text 与 vnode 的 text 是否相同。<ul>
<li>text 相同：什么都不做。</li>
<li>text 不相同：则把 oldVnode.elm 中的 innerText 改为 newVnode 的 text。</li>
</ul>
</li>
</ul>
</li>
<li>6、vnode 没有 text，则判读 children。<ul>
<li>vnode 中有 children：清空 oldVnode 中的 text，并且把 vnode 的 children 添加到 DOM 中。</li>
<li>oldVnode 中有 children：清空 oldVnode 中的 children。</li>
<li>oldVnode 中有 text：清空 oldVnode 中的 text。</li>
</ul>
</li>
<li>7、oldVnode 与 vnode 中都有 children，则进行精细化比较。精细化比较提供四种命中方式：<ol>
<li>新前与旧前（命中后，新前与旧前指针++）</li>
<li>新后与旧后（命中后，新增指针++，旧后指针--）</li>
<li>新后与旧前（命中后，新前指向的节点，移动到旧后之后新后指针--，旧前指针++）</li>
<li>新前与旧后（命中后，新前指向的节点，移动到旧前之前新前指针++，旧后指针--）</li>
</ol>
</li>
<li>8、如果四种命中方式都没命中，则进行循环查找，如果没有找到，则新曾的节点，插入到当前旧前指针之前；如果找到，则判断新旧节点 sel，相同则新曾的节点，插入到当前旧前指针之前，不相同则进行 patchVnode，把旧节点标记为 undefined，新插入到当前旧前指针之前。循环完以后新前指针++。</li>
</ul>
<h3 id="diff-算法简易版代码">diff 算法简易版代码</h3>
<p><strong>crateElement：</strong></p>
<pre><code class="hljs language-js"><span class="hljs-comment">/**
 * 创建节点
 */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createElement</span>(<span class="hljs-params">vnode</span>) {
    <span class="hljs-comment">// 创建一个DOM节点</span>
    <span class="hljs-keyword">let</span> domNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(vnode.<span class="hljs-property">sel</span>);

    <span class="hljs-comment">// 判断是有子节点还是文本</span>
    <span class="hljs-keyword">if</span> (
        vnode.<span class="hljs-property">text</span> != <span class="hljs-string">&quot;&quot;</span> &amp;&amp;
        (vnode.<span class="hljs-property">children</span> == <span class="hljs-literal">undefined</span> || vnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> == <span class="hljs-number">0</span>)
    ) {
        <span class="hljs-comment">// 是文本</span>
        domNode.<span class="hljs-property">innerText</span> = vnode.<span class="hljs-property">text</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(vnode.<span class="hljs-property">children</span>) &amp;&amp; vnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 是节点</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; vnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-comment">// 当前的children</span>
            <span class="hljs-keyword">let</span> ch = vnode.<span class="hljs-property">children</span>[i];
            <span class="hljs-comment">// 创建出它的DOM</span>
            <span class="hljs-keyword">let</span> chDOM = <span class="hljs-title function_">createElement</span>(ch);
            <span class="hljs-comment">// 上树</span>
            domNode.<span class="hljs-title function_">appendChild</span>(chDOM);
        }
    }
    <span class="hljs-comment">// 补充elm属性</span>
    vnode.<span class="hljs-property">elm</span> = domNode;
    <span class="hljs-comment">// 返回elm，elm是一个纯DOM对象</span>
    <span class="hljs-keyword">return</span> vnode.<span class="hljs-property">elm</span>;
}
</code></pre>
<p><strong>patch：</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> vnode <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./vnode.js&quot;</span>;
<span class="hljs-keyword">import</span> createElement <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./createElement.js&quot;</span>;
<span class="hljs-keyword">import</span> patchVnode <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./patchVnode.js&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">oldVnode, newVnode</span>) {
    <span class="hljs-comment">// 判断传入的一个参数，是DOM节点还是虚拟节点</span>
    <span class="hljs-keyword">if</span> (oldVnode.<span class="hljs-property">sel</span> == <span class="hljs-string">&quot;&quot;</span> || oldVnode.<span class="hljs-property">sel</span> == <span class="hljs-literal">undefined</span>) {
        <span class="hljs-comment">// oldVnode是DOM节点</span>
        oldVnode = <span class="hljs-title function_">vnode</span>(
            oldVnode.<span class="hljs-property">tagName</span>.<span class="hljs-title function_">toLowerCase</span>(),
            {},
            [],
            <span class="hljs-literal">undefined</span>,
            oldVnode
        );
    }

    <span class="hljs-comment">// 判断oldVnode和newVnode是不是同一个节点</span>
    <span class="hljs-keyword">if</span> (oldVnode.<span class="hljs-property">key</span> == newVnode.<span class="hljs-property">key</span> &amp;&amp; oldVnode.<span class="hljs-property">sel</span> == newVnode.<span class="hljs-property">sel</span>) {
        <span class="hljs-title function_">patchVnode</span>(oldVnode, newVnode);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">let</span> newVnodeElm = <span class="hljs-title function_">createElement</span>(newVnode);

        <span class="hljs-comment">// 插入到老节点之前</span>
        <span class="hljs-keyword">if</span> (oldVnode.<span class="hljs-property">elm</span>.<span class="hljs-property">parentNode</span> &amp;&amp; newVnodeElm) {
            oldVnode.<span class="hljs-property">elm</span>.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">insertBefore</span>(newVnodeElm, oldVnode.<span class="hljs-property">elm</span>);
        }

        <span class="hljs-comment">// 删除老节点</span>
        oldVnode.<span class="hljs-property">elm</span>.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(oldVnode.<span class="hljs-property">elm</span>);
    }
}
</code></pre>
<p><strong>patchVnode：</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> createElement <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./createElement.js&quot;</span>;
<span class="hljs-keyword">import</span> updateChildren <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./updateChildren.js&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">patchVnode</span>(<span class="hljs-params">oldVnode, newVnode</span>) {
    <span class="hljs-comment">// 判读新旧vnode是不是同一个</span>
    <span class="hljs-keyword">if</span> (oldVnode == newVnode) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">// 判断vnode有没有text属性</span>
    <span class="hljs-keyword">if</span> (
        newVnode.<span class="hljs-property">text</span> != <span class="hljs-literal">undefined</span> &amp;&amp;
        (newVnode.<span class="hljs-property">children</span> == <span class="hljs-literal">undefined</span> || newVnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> == <span class="hljs-number">0</span>)
    ) {
        <span class="hljs-comment">// 新vnode有text属性</span>
        <span class="hljs-keyword">if</span> (newVnode.<span class="hljs-property">text</span> != oldVnode.<span class="hljs-property">text</span>) {
            oldVnode.<span class="hljs-property">elm</span>.<span class="hljs-property">innerText</span> = newVnode.<span class="hljs-property">text</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 新vnode没有text属性</span>

        <span class="hljs-comment">// 判断老的有没有children</span>
        <span class="hljs-keyword">if</span> (oldVnode.<span class="hljs-property">children</span> != <span class="hljs-literal">undefined</span> &amp;&amp; oldVnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 新老节点都有children</span>
            <span class="hljs-title function_">updateChildren</span>(oldVnode.<span class="hljs-property">elm</span>, oldVnode.<span class="hljs-property">children</span>, newVnode.<span class="hljs-property">children</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 老的没有children，新的有children</span>
            oldVnode.<span class="hljs-property">elm</span>.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&quot;&quot;</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; newVnode.<span class="hljs-property">children</span>.<span class="hljs-property">length</span>; i++) {
                <span class="hljs-keyword">let</span> dom = <span class="hljs-title function_">createElement</span>(newVnode.<span class="hljs-property">children</span>[i]);
                oldVnode.<span class="hljs-property">elm</span>.<span class="hljs-title function_">appendChild</span>(dom);
            }
        }
    }
}
</code></pre>
<p><strong>updateChildren：</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> patchVnode <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./patchVnode.js&quot;</span>;
<span class="hljs-keyword">import</span> createElement <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./createElement.js&quot;</span>;

<span class="hljs-comment">// 判断是否是同一个虚拟节点</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sameVnode</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">return</span> a.<span class="hljs-property">sel</span> == b.<span class="hljs-property">sel</span> &amp;&amp; a.<span class="hljs-property">key</span> == b.<span class="hljs-property">key</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateChildren</span>(<span class="hljs-params">parentElm, oldCh, newCh</span>) {
    <span class="hljs-comment">// 旧前</span>
    <span class="hljs-keyword">let</span> oldStartIdx = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// 新前</span>
    <span class="hljs-keyword">let</span> newStartIdx = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// 旧后</span>
    <span class="hljs-keyword">let</span> oldEndIdx = oldCh.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
    <span class="hljs-comment">// 新后</span>
    <span class="hljs-keyword">let</span> newEndIdx = newCh.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
    <span class="hljs-comment">// 旧前节点</span>
    <span class="hljs-keyword">let</span> oldStartVnode = oldCh[<span class="hljs-number">0</span>];
    <span class="hljs-comment">// 新前节点</span>
    <span class="hljs-keyword">let</span> newStartVnode = newCh[<span class="hljs-number">0</span>];
    <span class="hljs-comment">// 旧后节点</span>
    <span class="hljs-keyword">let</span> oldEndVnode = oldCh[oldEndIdx];
    <span class="hljs-comment">// 新后节点</span>
    <span class="hljs-keyword">let</span> newEndVnode = newCh[newEndIdx];

    <span class="hljs-keyword">let</span> keyMap = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newStartIdx) {
        <span class="hljs-keyword">if</span> (oldStartVnode == <span class="hljs-literal">null</span> || oldCh[oldStartIdx] == <span class="hljs-literal">undefined</span>) {
            oldStartVnode = oldCh[++oldStartIdx];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldEndVnode == <span class="hljs-literal">null</span> || oldCh[oldEndIdx] == <span class="hljs-literal">undefined</span>) {
            oldEndVnode = oldCh[--oldEndIdx];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (newStartVnode == <span class="hljs-literal">null</span> || newCh[newStartIdx] == <span class="hljs-literal">undefined</span>) {
            newStartVnode = newCh[++newStartIdx];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (newEndVnode == <span class="hljs-literal">null</span> || newCh[newEndIdx] == <span class="hljs-literal">undefined</span>) {
            newEndVnode = newCh[--newEndIdx];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">sameVnode</span>(oldStartVnode, newStartVnode)) {
            <span class="hljs-comment">// 新前与旧前是同一个节点</span>
            <span class="hljs-title function_">patchVnode</span>(oldStartVnode, newStartVnode);
            <span class="hljs-comment">// 移动指针</span>
            oldStartVnode = oldCh[++oldStartIdx];
            newStartVnode = newCh[++newStartIdx];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">sameVnode</span>(oldEndVnode, newEndVnode)) {
            <span class="hljs-comment">// 新后与旧后是同一个节点</span>
            <span class="hljs-title function_">patchVnode</span>(oldEndVnode, newEndVnode);
            <span class="hljs-comment">// 移动指针</span>
            oldEndVnode = oldCh[--oldEndIdx];
            newEndVnode = newCh[--newEndIdx];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">sameVnode</span>(oldStartVnode, newEndVnode)) {
            <span class="hljs-comment">// 新后与旧前是同一个节点</span>
            <span class="hljs-title function_">patchVnode</span>(oldStartVnode, newEndVnode);
            <span class="hljs-comment">// 移动到旧后之后</span>
            parentElm.<span class="hljs-title function_">insertBefore</span>(
                oldStartVnode.<span class="hljs-property">elm</span>,
                oldEndVnode.<span class="hljs-property">elm</span>.<span class="hljs-property">nextSibling</span>
            );
            <span class="hljs-comment">// 移动指针</span>
            oldStartVnode = oldCh[++oldStartIdx];
            newEndVnode = newCh[--newEndIdx];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">sameVnode</span>(oldEndVnode, newStartVnode)) {
            <span class="hljs-comment">// 新前与旧后是同一个节点</span>
            <span class="hljs-title function_">patchVnode</span>(oldEndVnode, newStartVnode);
            <span class="hljs-comment">// 移动到旧前之前</span>
            parentElm.<span class="hljs-title function_">insertBefore</span>(oldEndVnode.<span class="hljs-property">elm</span>, oldStartVnode.<span class="hljs-property">elm</span>);
            <span class="hljs-comment">// 移动指针</span>
            newStartVnode = newCh[++newStartIdx];
            oldEndVnode = oldCh[--oldEndIdx];
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 四种都没命中</span>

            <span class="hljs-keyword">if</span> (!keyMap) {
                keyMap = {};
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = oldStartIdx; i &lt;= oldEndIdx; i++) {
                    <span class="hljs-keyword">const</span> key = oldCh[i].<span class="hljs-property">key</span>;
                    <span class="hljs-keyword">if</span> (key != <span class="hljs-literal">undefined</span>) {
                        keyMap[key] = i;
                    }
                }
            }
            <span class="hljs-keyword">const</span> idxInOld = keyMap[newStartVnode.<span class="hljs-property">key</span>];

            <span class="hljs-keyword">if</span> (idxInOld == <span class="hljs-literal">undefined</span>) {
                parentElm.<span class="hljs-title function_">insertBefore</span>(
                    <span class="hljs-title function_">createElement</span>(newStartVnode),
                    oldStartVnode.<span class="hljs-property">elm</span>
                );
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 不是全新的项,需要移动</span>
                <span class="hljs-keyword">const</span> elmToMove = oldCh[idxInOld];
                <span class="hljs-title function_">patchVnode</span>(elmToMove, newStartVnode);
                <span class="hljs-comment">// 把这项设置为undefined</span>
                oldCh[idxInOld] = <span class="hljs-literal">undefined</span>;
                parentElm.<span class="hljs-title function_">insertBefore</span>(elmToMove.<span class="hljs-property">elm</span>, oldStartVnode.<span class="hljs-property">elm</span>);
            }
            newStartVnode = newCh[++newStartIdx];
        }
    }

    <span class="hljs-comment">// 看有没有剩余</span>
    <span class="hljs-keyword">if</span> (newStartIdx &lt;= newEndIdx) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = newStartIdx; i &lt;= newEndIdx; i++) {
            parentElm.<span class="hljs-title function_">insertBefore</span>(<span class="hljs-title function_">createElement</span>(newCh[i]), oldCh[oldStartIdx]);
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldStartIdx &lt;= oldEndIdx) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = oldStartIdx; i &lt;= oldEndIdx; i++) {
            <span class="hljs-keyword">if</span> (oldCh[i]) {
                parentElm.<span class="hljs-title function_">removeChild</span>(oldCh[i].<span class="hljs-property">elm</span>);
            }
        }
    }
}
</code></pre>
<p><strong>vnode：</strong></p>
<pre><code class="hljs language-js"><span class="hljs-comment">// vnode就是把传入的5个参数组合成对象返回</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">vnode</span>(<span class="hljs-params">sel, data, children, text, elm</span>) {
    <span class="hljs-keyword">const</span> key = data.<span class="hljs-property">key</span>;
    <span class="hljs-keyword">return</span> {
        sel,
        data,
        children,
        text,
        elm,
        key,
    };
}
</code></pre>
</div>
        
      </div>
    </div>
  </body>
</html>
