<!DOCTYPE html>
<html lang="CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>Composition API(其它部分)</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <div class="nav">
        
        <div>
          <p class="menu">Git</p>
          <ul>
            <li>
              
              <a class="menu-item" href="3882148c-0b2c-42e5-b296-d0840ce5b1b5.html">
                Git 学习
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">JavaScript</p>
          <ul>
            <li>
              
              <a class="menu-item" href="c38a0720-f219-45c2-a4e2-8fd16a605ac9.html">
                JavaScript异步处理
              </a>
              
              <a class="menu-item" href="58151af3-b4ee-4d98-910a-af2f9e539daa.html">
                JavaScript数组
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">linux</p>
          <ul>
            <li>
              
              <a class="menu-item" href="ac95e51a-41a4-480b-b03d-579e6355e5fb.html">
                ArchLinux安装美化之系统安装
              </a>
              
              <a class="menu-item" href="ad70507b-6a95-4ffd-9402-b8056ac2b57b.html">
                Linux 压缩和解压缩命令
              </a>
              
              <a class="menu-item" href="d4f63889-5d89-400a-ad95-af8542bf9526.html">
                Linux 网络配置
              </a>
              
              <a class="menu-item" href="eeacbcc9-2a96-4162-8e36-8e174fe83e9c.html">
                nvm 安装与配置
              </a>
              
              <a class="menu-item" href="51285dee-d019-4bd7-9ca1-44b4c8b8cfa5.html">
                oh-my-zsh 安装与配置
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">MongDB</p>
          <ul>
            <li>
              
              <a class="menu-item" href="6b088c8e-f645-40cb-88c7-f07790f14ef4.html">
                MongoDB基本使用
              </a>
              
              <a class="menu-item" href="7fba68ff-4bbe-4808-8d2f-d6eb436b3bb2.html">
                MongoDB权限配置
              </a>
              
              <a class="menu-item" href="e36a6698-e63a-4a52-8a21-4b4087aa37f2.html">
                MongoDB进阶
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">Nginx</p>
          <ul>
            <li>
              
              <a class="menu-item" href="a6e365b4-cb4c-47fa-a1b5-4a0179f4ad1a.html">
                Nginx安装
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">npm</p>
          <ul>
            <li>
              
              <a class="menu-item" href="d6120c83-9835-4349-9851-eb8fdc618241.html">
                npm-workspace
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">PowerShell</p>
          <ul>
            <li>
              
              <a class="menu-item" href="e26e5a3f-8063-47e3-8c54-7f031b0e4da0.html">
                PoserShell 学习
              </a>
              
              <a class="menu-item" href="92c0884a-6dcd-4cae-8706-3b493f3c0ec6.html">
                powershell 命令
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">rust</p>
          <ul>
            <li>
              
              <a class="menu-item" href="4c42e7ab-5b8e-401f-bb78-e02af1e43931.html">
                Rust 基础
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">TypeScript</p>
          <ul>
            <li>
              
              <a class="menu-item" href="4fb7f7a9-c84b-4b5f-a9f7-a59746847cd2.html">
                TypeScript 基本项目搭建
              </a>
              
              <a class="menu-item" href="f9fd825f-3873-4bcf-98d8-0540b2ad564c.html">
                TypeScript类型与配置笔记
              </a>
              
              <a class="menu-item" href="830e7bca-c70e-46ac-bbe3-38c3fb074d31.html">
                TypeScript面向对象笔记
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">vscode</p>
          <ul>
            <li>
              
              <a class="menu-item" href="8eb6cf39-0fe0-44f4-9688-ba3a78ddcb01.html">
                vscode配置
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">vue3</p>
          <ul>
            <li>
              
              <a class="menu-item" href="376f3c97-98fa-4be3-8498-ad171ef47f5e.html">
                Composition API(其它部分)
              </a>
              
              <a class="menu-item" href="f952a41f-f7e7-4656-88a6-86227810f577.html">
                Composition API(常用部分)
              </a>
              
              <a class="menu-item" href="fd325294-cc0e-401a-b208-0aa020abe6c4.html">
                Vue3 新组件
              </a>
              
              <a class="menu-item" href="39684220-ebb6-4859-9ec5-cc5b281f29e2.html">
                vue3快速上手
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">webpack</p>
          <ul>
            <li>
              
              <a class="menu-item" href="ae49d136-883a-44c1-95a2-0304faa72659.html">
                vue+ts+eslint前端项目搭建
              </a>
              
              <a class="menu-item" href="2909c6fc-8b52-40de-970a-b407186840c7.html">
                webpack + vue 企业级项目搭建
              </a>
              
              <a class="menu-item" href="f1aaab61-c7bd-46a3-b924-4d09f1365b3b.html">
                webpack
              </a>
              
              <a class="menu-item" href="50f1a98c-1bb2-4a66-b45f-68a5c20d2d15.html">
                webpack配置
              </a>
              
              <a class="menu-item" href="bd69632e-826e-4963-aa5c-bc637a478fa0.html">
                前端常用
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">Windows</p>
          <ul>
            <li>
              
              <a class="menu-item" href="4c6ae43e-cb77-4bcd-b124-5d9445203188.html">
                Windows Terminal设置代理
              </a>
              
              <a class="menu-item" href="d46e04e5-8dcd-43cc-8550-4b30f990ac25.html">
                Windows安装优化
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">其它</p>
          <ul>
            <li>
              
              <a class="menu-item" href="49e1a6ba-d046-4f4d-bfab-3822f26c63eb.html">
                mustache模板引擎
              </a>
              
              <a class="menu-item" href="88eb9688-23bc-4f31-8ce3-7059b82404b2.html">
                双向数据绑定
              </a>
              
              <a class="menu-item" href="d7f3c26e-b00c-4994-83c9-e8cece3b69bd.html">
                抽象语法树
              </a>
              
              <a class="menu-item" href="3f4ef750-bcd5-4bf8-9d93-d0e104fb3e5c.html">
                虚拟DOM与diff算法
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">打包构建工具</p>
          <ul>
            <li>
              
              <a class="menu-item" href="a6cd94be-cdc2-409b-b22f-9b27174f24ac.html">
                Grunt
              </a>
              
              <a class="menu-item" href="04185fa8-85fc-4a99-9b72-4034b9bcb0a2.html">
                Gulp
              </a>
              
              <a class="menu-item" href="bf96905d-6e68-4d2a-a6b5-1622150bf8a6.html">
                Rollup
              </a>
              
            </li>
          </ul>
        </div>
        
      </div>
      <div class="content">
        
        <div><h1 id="composition-api其它部分">Composition API(其它部分)</h1>
<h2 id="composition-api其它部分-1">Composition API(其它部分)</h2>
<h3 id="2、1、shallowreactive-与-shallowref">2、1、shallowReactive 与 shallowRef</h3>
<ul>
<li><p>shallowReactive : 只处理了对象内最外层属性的响应式(也就是浅响应式)</p>
</li>
<li><p>shallowRef: 只处理了 value 的响应式, 不进行对象的 reactive 处理</p>
</li>
<li><p>什么时候用浅响应式呢?</p>
<ul>
<li>一般情况下使用 ref 和 reactive 即可</li>
<li>如果有一个对象数据, 结构比较深, 但变化时只是外层属性变化 ===&gt; shallowReactive</li>
<li>如果有一个对象数据, 后面会产生新的对象来替换 ===&gt; shallowRef</li>
</ul>
</li>
</ul>
<p> <strong>示例代码</strong></p>
<pre><code class="hljs language-vue">&lt;template&gt;
    &lt;h1&gt;shallowReactive 与 shallowRef&lt;/h1&gt;
    &lt;h3&gt;m1: {{ m1 }}&lt;/h3&gt;
    &lt;h3&gt;m2: {{ m2 }}&lt;/h3&gt;
    &lt;h3&gt;m3: {{ m3 }}&lt;/h3&gt;
    &lt;h3&gt;m4: {{ m4 }}&lt;/h3&gt;

    &lt;hr /&gt;
    &lt;button @click=&quot;update&quot;&gt;更新数据&lt;/button&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import {
    defineComponent,
    reactive,
    ref,
    shallowReactive,
    shallowRef,
    toRef,
    isRef,
} from &quot;vue&quot;;

export default defineComponent({
    name: &quot;App&quot;,
    setup() {
        const m1 = ref({
            name: &quot;Best Shi&quot;,
            age: 20,
            wife: {
                name: &quot;Small Shell&quot;,
                age: 18,
            },
        });
        const m2 = reactive({
            name: &quot;Best Shi&quot;,
            age: 20,
            wife: {
                name: &quot;Small Shell&quot;,
                age: 18,
            },
        });

        const m3 = shallowReactive({
            name: &quot;Best Shi&quot;,
            age: 20,
            wife: {
                name: &quot;Small Shell&quot;,
                age: 18,
            },
        });
        const m4 = shallowRef({
            name: &quot;Best Shi&quot;,
            age: 20,
            wife: {
                name: &quot;Small Shell&quot;,
                age: 18,
            },
        });

        const update = () =&gt; {
            console.log(m1);
            console.log(m2);

            console.log(m3.wife);
            console.log(m4);

            m1.value.wife.name += &quot;==&quot;;
            m2.wife.name += &quot;**&quot;;
            m3.wife.name += &quot;---&quot;;
            m4.value.wife.name += &quot;》》》&quot;;
        };
        return {
            m1,
            m2,
            m3,
            m4,
            update,
        };
    },
});
&lt;/script&gt;
</code></pre>
<h3 id="2、readonly-与-shallowreadonly">2、Readonly 与 shallowReadonly</h3>
<ul>
<li>readonly:<ul>
<li>深度只读数据</li>
<li>获取一个对象 (响应式或纯对象) 或 ref 并返回原始代理的只读代理。</li>
<li>只读代理是深层的：访问的任何嵌套 property 也是只读的。</li>
</ul>
</li>
<li>shallowReadonly<ul>
<li>浅只读数据</li>
<li>创建一个代理，使其自身的 property 为只读，但不执行嵌套对象的深度只读转换</li>
</ul>
</li>
<li>应用场景:<ul>
<li>在某些特定情况下, 我们可能不希望对数据进行更新的操作, 那就可以包装生成一个只读代理对象来读取数据, 而不能修改或删除</li>
</ul>
</li>
</ul>
<h3 id="3、toraw-与-markraw">3、toRaw 与 markRaw</h3>
<ul>
<li>toRaw<ul>
<li>返回由 reactive 或 readonly 方法转换成响应式代理的普通对象。</li>
<li>这是一个还原方法，可用于临时读取，访问不会被代理/跟踪，写入时也不会触发界面更新。</li>
</ul>
</li>
<li>markRaw<ul>
<li>标记一个对象，使其永远不会转换为代理。返回对象本身</li>
</ul>
</li>
<li>应用场景:<ul>
<li>有些值不应被设置为响应式的，例如复杂的第三方类实例或 Vue 组件对象。</li>
<li>当渲染具有不可变数据源的大列表时，跳过代理转换可以提高性能。</li>
</ul>
</li>
</ul>
<h3 id="4、toref">4、toRef</h3>
<ul>
<li>为源响应式对象上的某个属性创建一个 ref 对象, 二者内部操作的是同一个数据值, 更新时二者是同步的</li>
<li>区别 ref: 拷贝了一份新的数据值单独操作, 更新时相互不影响</li>
<li>应用: 当要将 某个 prop 的 ref 传递给复合函数时，toRef 很有用</li>
</ul>
<h3 id="5、customref">5、customRef</h3>
<ul>
<li>创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制</li>
<li>需求: 使用 customRef 实现 debounce 的示例</li>
</ul>
<p> <strong>示例代码</strong></p>
<pre><code class="hljs language-vue">&lt;template&gt;
    &lt;h1&gt;customRef使用&lt;/h1&gt;
    &lt;input type=&quot;text&quot; v-model=&quot;keyword&quot; /&gt;
    &lt;hr /&gt;
    &lt;p&gt;{{ keyword }}&lt;/p&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import { customRef, defineComponent } from &quot;vue&quot;;
import { set } from &quot;vue/types/umd&quot;;

function useDebounce&lt;T&gt;(value: T, delay = 200) {
    let timeOutId: number;
    return customRef((track, trigger) =&gt; {
        return {
            get() {
                track();
                return value;
            },
            set(newVal: T) {
                clearTimeout(timeOutId);
                setTimeout(() =&gt; {
                    value = newVal;
                    trigger();
                }, delay);
            },
        };
    });
}

export default defineComponent({
    name: &quot;App&quot;,
    setup() {
        const keyword = useDebounce(&quot;&quot;, 2000);
        return {
            keyword,
        };
    },
});
&lt;/script&gt;
</code></pre>
<h3 id="6、provide-与-inject">6、provide 与 inject</h3>
<ul>
<li>实现跨层级组件(祖孙)间通信</li>
</ul>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-vue">// App.vue
&lt;template&gt;
    &lt;h1&gt;provide 与 inject&lt;/h1&gt;
    &lt;div&gt;
        &lt;h3&gt;父级组件&lt;/h3&gt;
        &lt;input type=&quot;text&quot; v-model=&quot;keyword&quot; /&gt;
        &lt;hr /&gt;
        &lt;p&gt;:{{ keyword }}&lt;/p&gt;
        &lt;Son&gt;&lt;/Son&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import { defineComponent, provide, ref } from &quot;vue&quot;;
import Son from &quot;./components/Son.vue&quot;;

export default defineComponent({
    name: &quot;App&quot;,
    components: {
        Son,
    },
    setup() {
        const keyword = ref();
        provide(&quot;keyword&quot;, keyword);
        return {
            keyword,
        };
    },
});
&lt;/script&gt;

&lt;style&gt;
div {
    border: 1px solid #008c8c;
    padding: 20px;
}
&lt;/style&gt;
</code></pre>
<pre><code class="hljs language-vue">// ./components/Son.vue
&lt;template&gt;
    &lt;div&gt;
        &lt;h3&gt;子级组件&lt;/h3&gt;
        &lt;hr /&gt;
        &lt;Grandson&gt;&lt;/Grandson&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import { defineComponent } from &quot;vue&quot;;
import Grandson from &quot;./Grandson.vue&quot;;

export default defineComponent({
    name: &quot;Son&quot;,
    components: {
        Grandson,
    },
    setup() {
        return {};
    },
});
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-vue">// ./components/Grandson.vue
&lt;template&gt;
    &lt;div&gt;
        &lt;h3&gt;子孙级组件&lt;/h3&gt;
        &lt;p&gt;:{{ keyword }}&lt;/p&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import { defineComponent, inject } from &quot;vue&quot;;

export default defineComponent({
    name: &quot;Grandson&quot;,
    setup() {
        const keyword = inject(&quot;keyword&quot;);
        return {
            keyword,
        };
    },
});
&lt;/script&gt;
</code></pre>
<h3 id="7、响应式数据的判断">7、响应式数据的判断</h3>
<ul>
<li>isRef: 检查一个值是否为一个 ref 对象</li>
<li>isReactive: 检查一个对象是否是由 reactive 创建的响应式代理</li>
<li>isReadonly: 检查一个对象是否是由 readonly 创建的只读代理</li>
<li>isProxy: 检查一个对象是否是由 reactive 或者 readonly 方法创建的代理</li>
</ul>
</div>
        
      </div>
    </div>
  </body>
</html>
