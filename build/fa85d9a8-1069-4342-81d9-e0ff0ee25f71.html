<!DOCTYPE html>
<html lang="CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>Composition API(其它部分)</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <div class="nav">
        
        <div>
          <p class="menu">Git</p>
          <ul>
            <li>
              
              <a class="menu-item" href="04dd9b66-21a0-4022-ace2-88128581e905.html">
                Git 学习
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">JavaScript</p>
          <ul>
            <li>
              
              <a class="menu-item" href="7780599f-93a0-4043-bd09-d501fe5c0957.html">
                JavaScript异步处理
              </a>
              
              <a class="menu-item" href="f13ba8a9-5097-4af1-8b45-0992d1381622.html">
                JavaScript数组
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">linux</p>
          <ul>
            <li>
              
              <a class="menu-item" href="2bdc5f72-7bc5-45e1-843c-81374ef92b8d.html">
                ArchLinux安装美化之系统安装
              </a>
              
              <a class="menu-item" href="b9ed9c39-de85-47dc-990f-08a46225027c.html">
                Linux 压缩和解压缩命令
              </a>
              
              <a class="menu-item" href="24508bb6-1c34-45e7-809f-ce09a3046113.html">
                Linux 网络配置
              </a>
              
              <a class="menu-item" href="a98d50e4-6cc4-47b8-a564-4ae0d707db1e.html">
                nvm 安装与配置
              </a>
              
              <a class="menu-item" href="604445db-1794-4ef0-9c9c-1059c56437ba.html">
                oh-my-zsh 安装与配置
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">MongDB</p>
          <ul>
            <li>
              
              <a class="menu-item" href="18fb8215-7617-4cf8-b22b-9957f66c5893.html">
                MongoDB基本使用
              </a>
              
              <a class="menu-item" href="ec8c8c89-6775-4f80-bae5-83b59b50dac0.html">
                MongoDB权限配置
              </a>
              
              <a class="menu-item" href="8647bad3-78b4-4f07-8fff-35e9db7d8da6.html">
                MongoDB进阶
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">Nginx</p>
          <ul>
            <li>
              
              <a class="menu-item" href="50848776-a5be-4d0b-86d3-62e82c5d842a.html">
                Nginx安装
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">npm</p>
          <ul>
            <li>
              
              <a class="menu-item" href="b24236c6-e4dd-422a-8a47-246a1c4a1ef8.html">
                npm-workspace
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">PowerShell</p>
          <ul>
            <li>
              
              <a class="menu-item" href="9907b1a0-41e4-4117-881d-483ca01607fa.html">
                PoserShell 学习
              </a>
              
              <a class="menu-item" href="f1ebd3f6-0685-4af2-8e8b-fbfd87a8b06f.html">
                powershell 命令
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">rust</p>
          <ul>
            <li>
              
              <a class="menu-item" href="ce04efaf-8b85-4342-81fb-80334e7f4a62.html">
                Rust 基础
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">TypeScript</p>
          <ul>
            <li>
              
              <a class="menu-item" href="74401e20-7f5a-4cd6-a26c-6223819f96ca.html">
                TypeScript 基本项目搭建
              </a>
              
              <a class="menu-item" href="0ebcd04c-8c38-4e13-bac6-4c1c70151b02.html">
                TypeScript类型与配置笔记
              </a>
              
              <a class="menu-item" href="4e695865-22c1-43f3-94d2-98e7e1582854.html">
                TypeScript面向对象笔记
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">vscode</p>
          <ul>
            <li>
              
              <a class="menu-item" href="d0d823db-24ce-4e71-b8f0-390fbbd15a75.html">
                vscode配置
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">vue3</p>
          <ul>
            <li>
              
              <a class="menu-item" href="fa85d9a8-1069-4342-81d9-e0ff0ee25f71.html">
                Composition API(其它部分)
              </a>
              
              <a class="menu-item" href="6904e5fe-e1ee-4fa9-b4fb-ffd7c443235a.html">
                Composition API(常用部分)
              </a>
              
              <a class="menu-item" href="fc217708-8e1c-42b7-968e-fba530aa0d64.html">
                Vue3 新组件
              </a>
              
              <a class="menu-item" href="08d2855d-2fba-4544-887b-15cedbbabe4e.html">
                vue3快速上手
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">webpack</p>
          <ul>
            <li>
              
              <a class="menu-item" href="c81657b3-b382-4a26-8c1a-fa4741f44861.html">
                vue+ts+eslint前端项目搭建
              </a>
              
              <a class="menu-item" href="5d096691-64d6-4704-8e8c-fa0cbebdda8d.html">
                webpack + vue 企业级项目搭建
              </a>
              
              <a class="menu-item" href="0b88c60d-38ba-4bd0-a3c9-7b6bf0d1f62e.html">
                webpack
              </a>
              
              <a class="menu-item" href="302d11a7-d295-4ba0-879f-63779df8c279.html">
                webpack配置
              </a>
              
              <a class="menu-item" href="4716ec92-4f87-4733-bfa4-37353175552c.html">
                前端常用
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">Windows</p>
          <ul>
            <li>
              
              <a class="menu-item" href="4c96ec1d-6e1b-405a-a01c-b693020edb93.html">
                Windows Terminal设置代理
              </a>
              
              <a class="menu-item" href="06f75a60-76b5-4e72-a820-3325800d9d89.html">
                Windows安装优化
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">其它</p>
          <ul>
            <li>
              
              <a class="menu-item" href="cbcd108e-b08f-4b89-92ad-213b10b18086.html">
                mustache模板引擎
              </a>
              
              <a class="menu-item" href="3d1dda8b-67c9-4a2b-b984-3d60e59cf509.html">
                双向数据绑定
              </a>
              
              <a class="menu-item" href="83b423b0-396d-4753-827f-bb9fa110a4e9.html">
                抽象语法树
              </a>
              
              <a class="menu-item" href="e90b0ae2-c418-4470-82c7-5af9f11aea76.html">
                虚拟DOM与diff算法
              </a>
              
            </li>
          </ul>
        </div>
        
        <div>
          <p class="menu">打包构建工具</p>
          <ul>
            <li>
              
              <a class="menu-item" href="2f7bc079-6ab0-4423-b805-d7fb542fbda3.html">
                Grunt
              </a>
              
              <a class="menu-item" href="b66c16d5-e252-4f28-a58c-4d9bc16c313a.html">
                Gulp
              </a>
              
              <a class="menu-item" href="db851e7e-8714-449f-9460-91b814d18eb3.html">
                Rollup
              </a>
              
            </li>
          </ul>
        </div>
        
      </div>
      <div class="content">
        
        <div><h1 id="composition-api其它部分">Composition API(其它部分)</h1>
<h2 id="composition-api其它部分-1">Composition API(其它部分)</h2>
<h3 id="2、1、shallowreactive-与-shallowref">2、1、shallowReactive 与 shallowRef</h3>
<ul>
<li><p>shallowReactive : 只处理了对象内最外层属性的响应式(也就是浅响应式)</p>
</li>
<li><p>shallowRef: 只处理了 value 的响应式, 不进行对象的 reactive 处理</p>
</li>
<li><p>什么时候用浅响应式呢?</p>
<ul>
<li>一般情况下使用 ref 和 reactive 即可</li>
<li>如果有一个对象数据, 结构比较深, 但变化时只是外层属性变化 ===&gt; shallowReactive</li>
<li>如果有一个对象数据, 后面会产生新的对象来替换 ===&gt; shallowRef</li>
</ul>
</li>
</ul>
<p> <strong>示例代码</strong></p>
<pre><code class="hljs language-vue">&lt;template&gt;
    &lt;h1&gt;shallowReactive 与 shallowRef&lt;/h1&gt;
    &lt;h3&gt;m1: {{ m1 }}&lt;/h3&gt;
    &lt;h3&gt;m2: {{ m2 }}&lt;/h3&gt;
    &lt;h3&gt;m3: {{ m3 }}&lt;/h3&gt;
    &lt;h3&gt;m4: {{ m4 }}&lt;/h3&gt;

    &lt;hr /&gt;
    &lt;button @click=&quot;update&quot;&gt;更新数据&lt;/button&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import {
    defineComponent,
    reactive,
    ref,
    shallowReactive,
    shallowRef,
    toRef,
    isRef,
} from &quot;vue&quot;;

export default defineComponent({
    name: &quot;App&quot;,
    setup() {
        const m1 = ref({
            name: &quot;Best Shi&quot;,
            age: 20,
            wife: {
                name: &quot;Small Shell&quot;,
                age: 18,
            },
        });
        const m2 = reactive({
            name: &quot;Best Shi&quot;,
            age: 20,
            wife: {
                name: &quot;Small Shell&quot;,
                age: 18,
            },
        });

        const m3 = shallowReactive({
            name: &quot;Best Shi&quot;,
            age: 20,
            wife: {
                name: &quot;Small Shell&quot;,
                age: 18,
            },
        });
        const m4 = shallowRef({
            name: &quot;Best Shi&quot;,
            age: 20,
            wife: {
                name: &quot;Small Shell&quot;,
                age: 18,
            },
        });

        const update = () =&gt; {
            console.log(m1);
            console.log(m2);

            console.log(m3.wife);
            console.log(m4);

            m1.value.wife.name += &quot;==&quot;;
            m2.wife.name += &quot;**&quot;;
            m3.wife.name += &quot;---&quot;;
            m4.value.wife.name += &quot;》》》&quot;;
        };
        return {
            m1,
            m2,
            m3,
            m4,
            update,
        };
    },
});
&lt;/script&gt;
</code></pre>
<h3 id="2、readonly-与-shallowreadonly">2、Readonly 与 shallowReadonly</h3>
<ul>
<li>readonly:<ul>
<li>深度只读数据</li>
<li>获取一个对象 (响应式或纯对象) 或 ref 并返回原始代理的只读代理。</li>
<li>只读代理是深层的：访问的任何嵌套 property 也是只读的。</li>
</ul>
</li>
<li>shallowReadonly<ul>
<li>浅只读数据</li>
<li>创建一个代理，使其自身的 property 为只读，但不执行嵌套对象的深度只读转换</li>
</ul>
</li>
<li>应用场景:<ul>
<li>在某些特定情况下, 我们可能不希望对数据进行更新的操作, 那就可以包装生成一个只读代理对象来读取数据, 而不能修改或删除</li>
</ul>
</li>
</ul>
<h3 id="3、toraw-与-markraw">3、toRaw 与 markRaw</h3>
<ul>
<li>toRaw<ul>
<li>返回由 reactive 或 readonly 方法转换成响应式代理的普通对象。</li>
<li>这是一个还原方法，可用于临时读取，访问不会被代理/跟踪，写入时也不会触发界面更新。</li>
</ul>
</li>
<li>markRaw<ul>
<li>标记一个对象，使其永远不会转换为代理。返回对象本身</li>
</ul>
</li>
<li>应用场景:<ul>
<li>有些值不应被设置为响应式的，例如复杂的第三方类实例或 Vue 组件对象。</li>
<li>当渲染具有不可变数据源的大列表时，跳过代理转换可以提高性能。</li>
</ul>
</li>
</ul>
<h3 id="4、toref">4、toRef</h3>
<ul>
<li>为源响应式对象上的某个属性创建一个 ref 对象, 二者内部操作的是同一个数据值, 更新时二者是同步的</li>
<li>区别 ref: 拷贝了一份新的数据值单独操作, 更新时相互不影响</li>
<li>应用: 当要将 某个 prop 的 ref 传递给复合函数时，toRef 很有用</li>
</ul>
<h3 id="5、customref">5、customRef</h3>
<ul>
<li>创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制</li>
<li>需求: 使用 customRef 实现 debounce 的示例</li>
</ul>
<p> <strong>示例代码</strong></p>
<pre><code class="hljs language-vue">&lt;template&gt;
    &lt;h1&gt;customRef使用&lt;/h1&gt;
    &lt;input type=&quot;text&quot; v-model=&quot;keyword&quot; /&gt;
    &lt;hr /&gt;
    &lt;p&gt;{{ keyword }}&lt;/p&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import { customRef, defineComponent } from &quot;vue&quot;;
import { set } from &quot;vue/types/umd&quot;;

function useDebounce&lt;T&gt;(value: T, delay = 200) {
    let timeOutId: number;
    return customRef((track, trigger) =&gt; {
        return {
            get() {
                track();
                return value;
            },
            set(newVal: T) {
                clearTimeout(timeOutId);
                setTimeout(() =&gt; {
                    value = newVal;
                    trigger();
                }, delay);
            },
        };
    });
}

export default defineComponent({
    name: &quot;App&quot;,
    setup() {
        const keyword = useDebounce(&quot;&quot;, 2000);
        return {
            keyword,
        };
    },
});
&lt;/script&gt;
</code></pre>
<h3 id="6、provide-与-inject">6、provide 与 inject</h3>
<ul>
<li>实现跨层级组件(祖孙)间通信</li>
</ul>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-vue">// App.vue
&lt;template&gt;
    &lt;h1&gt;provide 与 inject&lt;/h1&gt;
    &lt;div&gt;
        &lt;h3&gt;父级组件&lt;/h3&gt;
        &lt;input type=&quot;text&quot; v-model=&quot;keyword&quot; /&gt;
        &lt;hr /&gt;
        &lt;p&gt;:{{ keyword }}&lt;/p&gt;
        &lt;Son&gt;&lt;/Son&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import { defineComponent, provide, ref } from &quot;vue&quot;;
import Son from &quot;./components/Son.vue&quot;;

export default defineComponent({
    name: &quot;App&quot;,
    components: {
        Son,
    },
    setup() {
        const keyword = ref();
        provide(&quot;keyword&quot;, keyword);
        return {
            keyword,
        };
    },
});
&lt;/script&gt;

&lt;style&gt;
div {
    border: 1px solid #008c8c;
    padding: 20px;
}
&lt;/style&gt;
</code></pre>
<pre><code class="hljs language-vue">// ./components/Son.vue
&lt;template&gt;
    &lt;div&gt;
        &lt;h3&gt;子级组件&lt;/h3&gt;
        &lt;hr /&gt;
        &lt;Grandson&gt;&lt;/Grandson&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import { defineComponent } from &quot;vue&quot;;
import Grandson from &quot;./Grandson.vue&quot;;

export default defineComponent({
    name: &quot;Son&quot;,
    components: {
        Grandson,
    },
    setup() {
        return {};
    },
});
&lt;/script&gt;
</code></pre>
<pre><code class="hljs language-vue">// ./components/Grandson.vue
&lt;template&gt;
    &lt;div&gt;
        &lt;h3&gt;子孙级组件&lt;/h3&gt;
        &lt;p&gt;:{{ keyword }}&lt;/p&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script lang=&quot;ts&quot;&gt;
import { defineComponent, inject } from &quot;vue&quot;;

export default defineComponent({
    name: &quot;Grandson&quot;,
    setup() {
        const keyword = inject(&quot;keyword&quot;);
        return {
            keyword,
        };
    },
});
&lt;/script&gt;
</code></pre>
<h3 id="7、响应式数据的判断">7、响应式数据的判断</h3>
<ul>
<li>isRef: 检查一个值是否为一个 ref 对象</li>
<li>isReactive: 检查一个对象是否是由 reactive 创建的响应式代理</li>
<li>isReadonly: 检查一个对象是否是由 readonly 创建的只读代理</li>
<li>isProxy: 检查一个对象是否是由 reactive 或者 readonly 方法创建的代理</li>
</ul>
</div>
        
      </div>
    </div>
  </body>
</html>
